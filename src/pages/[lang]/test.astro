---
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
    return [{ params: { lang: 'fr' } }, { params: { lang: 'en' } }];
}

const { lang } = Astro.params;

const previews = [
    {
        id: 'serpent',
        title: 'comme un serpent dans une flûte',
        poems: [
            ['Aujourd’hui j’ai l’humeur', 'd’un saute pleureur'],
            ['la cuillère dans le pot de fer', 'en finesse te réveillera'],
            ['bon ou mavais', 'voici des moments'],
            ['rebord de fenêtre', 'blablabla', 'le vent qui pousse'],
            ['quand le tram lance des éclairs', 'c’est bout de rentrerr'],
        ],
    },
    {
        id: 'coquilles',
        title: 'des coquilles et des pépins',
        poems: [
            ['je racle la pluie', 'sur le bord du jour'],
            ['éventail ouvert', 'sur des jours de menthe'],
            ['je marche', 'dans le sable mou', 'l’ongle en étoile'],
            ['tout ce que j’écris s’efface', 'entre deux touffes'],
            ['le dos', 'du mot', 'est plus froid', 'que l’encre'],
        ],
    },
];

export const prerender = true;
---

<Layout title={lang === 'fr' ? 'TEST —> FR' : 'TEST —> EN'}>
    <div class='wrapper-test'>
        <h1 class='mix-blend-target'>malou raulin</h1>
        <div class='flex gap-4'>
            <div class='wrapper-project flex gap-4'>
                {
                    previews.map((recueil, index) => (
                        <div
                            class={`project w-[100px] h-[calc(100vh-50px)] flex items-center justify-center cursor-pointer ${
                                index === 0 ? 'bg-red-500' : 'bg-blue-500'
                            }`}
                            data-id={recueil.id}
                        >
                            <span class='text-white text-center px-2'>
                                {recueil.title}
                            </span>
                        </div>
                    ))
                }
            </div>
            <div
                class='wrapper-preview h-[calc(100vh-50px)] flex-1 bg-amber-200 overflow-hidden relative'
            ></div>
        </div>
    </div>

    <style>
        .preview-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            padding: 2rem;
            font-style: italic;
            font-size: 1.1rem;
            color: #000;
        }

        .preview-segment {
            display: inline-block;
            transform-origin: left center;
        }
    </style>

    <script type='module'>
        const previews = [
            {
                id: 'serpent',
                title: 'comme un serpent dans une flûte',
                poems: [
                    ['Aujourd’hui j’ai l’humeur', 'd’un saute pleureur'],
                    [
                        'la cuillère dans le pot de fer',
                        'en finesse te réveillera',
                    ],
                    ['bon ou mavais', 'voici des moments'],
                    ['rebord de fenêtre', 'blablabla', 'le vent qui pousse'],
                    [
                        'quand le tram lance des éclairs',
                        'c’est bout de rentrerr',
                    ],
                ],
            },
            {
                id: 'coquilles',
                title: 'des coquilles et des pépins',
                poems: [
                    ['je racle la pluie', 'sur le bord du jour'],
                    ['éventail ouvert', 'sur des jours de menthe'],
                    ['je marche', 'dans le sable mou', 'l’ongle en étoile'],
                    ['tout ce que j’écris s’efface', 'entre deux touffes'],
                    ['le dos', 'du mot', 'est plus froid', 'que l’encre'],
                ],
            },
        ];
        function createPreviewHTML(segments) {
            const container = document.createElement('div');
            container.classList.add('preview-container');

            segments.forEach((segment) => {
                const span = document.createElement('span');
                span.textContent = segment;
                span.classList.add('preview-segment');

                const angle = Math.floor(Math.random() * 11) - 5;
                span.style.transform = `rotate(${angle}deg)`;

                container.appendChild(span);
            });

            return container;
        }

        const projects = document.querySelectorAll('.project');
        const previewWrapper = document.querySelector('.wrapper-preview');

        projects.forEach((project) => {
            const id = project.dataset.id;

            project.addEventListener('mouseenter', () => {
                const recueil = previews.find((r) => r.id === id);
                const poem =
                    recueil.poems[
                        Math.floor(Math.random() * recueil.poems.length)
                    ];

                previewWrapper.innerHTML = '';
                previewWrapper.appendChild(createPreviewHTML(poem));
            });

            project.addEventListener('mouseleave', () => {
                previewWrapper.innerHTML = '';
            });
        });
    </script>
</Layout>
